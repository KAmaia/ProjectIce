desc 'rake'
task :default do
    puts '|----------|'
	puts '|> proto   |'
    puts '|> stats   |'
    puts '|> update  |'
    puts '|> analyse |'
    puts '|----------|'
end

desc 'Build proto buffers'
task :proto do
	system('protoc --cpp_out=./src/proto ./src/proto/*')
end

desc 'rake stats'
task :stats do
	system('cloc --quiet --no3 --exclude-dir=./src/proto/ src/')
	system('echo "Git commits: "; git shortlog | wc -l')
end

desc 'Updates tags and premakes on background'
task :update do
	while true do
		system('premake4 gmake')
		system('cscope -R -b ')
		system('ctags -R --c-kinds=+p --fields=+iaS --extra=+q -R .')

		sleep(60)
	end
end

desc 'Run static analysis'
task :analyse do
	system('make clean && scan-build -o /var/www/scan-build/ make')
end
